generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(cuid())
  name           String?
  username       String?         @unique
  email          String          @unique
  emailVerified  DateTime?
  password       String?
  image          String?
  role           String          @default("BUYER")
  balance        Float           @default(0)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  accounts       Account[]
  buyerRequests  BuyerRequest[]
  realtorProfile RealtorProfile?
  sessions       Session[]
  transactions   Transaction[]
  unlockedLeads  UnlockedLead[]
}

model RealtorProfile {
  id              String     @id @default(cuid())
  userId          String     @unique
  licenseNumber   String
  brokerage       String
  languages       String
  experienceYears Int
  states          String
  cities          String
  buyerTypes      String?
  propertyTypes   String?
  bio             String?
  isVerified      Boolean    @default(false)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  priceRange      String?
  leads           Lead[]
  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  referrals       Referral[]
}

model BuyerRequest {
  id        String     @id @default(cuid())
  userId    String?
  name      String
  email     String
  phone     String
  budgetMin Int?
  budgetMax Int?
  timeframe String?
  locations String
  languages String?
  createdAt DateTime   @default(now())
  user      User?      @relation(fields: [userId], references: [id])
  referrals Referral[]
}

model Referral {
  id             String         @id @default(cuid())
  buyerRequestId String
  realtorId      String
  status         String         @default("SENT")
  notes          String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  realtor        RealtorProfile @relation(fields: [realtorId], references: [id])
  buyerRequest   BuyerRequest   @relation(fields: [buyerRequestId], references: [id])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model RealtorApplication {
  id                      String   @id @default(cuid())
  fullName                String
  email                   String
  phone                   String
  preferredContactMethod  String?
  brokerageName           String
  licenseNumber           String
  statesLicensed          String
  experienceYears         String
  primaryMarkets          String
  acceptingNewClients     String?
  buyerSpecializations    String
  languages               String
  otherLanguage           String?
  referralAcknowledgement Boolean
  additionalContext       String?
  status                  String   @default("pending")
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model Lead {
  id                 String          @id @default(cuid())
  agentId            String?
  buyerName          String
  buyerEmail         String?
  buyerPhone         String?
  buyerContact       String?
  message            String?
  city               String
  zipcode            String
  lat                Float?
  lng                Float?
  buyerType          String?
  interest           String?
  languagePreference String?
  timeline           String?
  price              Float           @default(30)
  status             String          @default("locked")
  createdAt          DateTime        @default(now())
  agent              RealtorProfile? @relation(fields: [agentId], references: [id])
  unlockedBy         UnlockedLead[]
}

model Payment {
  id        String   @id @default(cuid())
  realtorId String
  amount    Float
  purpose   String
  status    String   @default("pending")
  createdAt DateTime @default(now())
}

model UnlockedLead {
  id        String   @id @default(cuid())
  userId    String
  leadId    String
  createdAt DateTime @default(now())
  lead      Lead     @relation(fields: [leadId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, leadId])
}

model Transaction {
  id              String   @id @default(cuid())
  userId          String
  amount          Float
  type            String
  stripeSessionId String?
  status          String   @default("completed")
  createdAt       DateTime @default(now())
  user            User     @relation(fields: [userId], references: [id])
}
